<template>
  <v-app>
    <v-main class="full-screen-container pa-0">
      <v-container
        fluid
        class="pa-0 fill-height d-flex flex-column"
        style="height: 100vh"
      >
        <div class="marquee-bar d-flex align-center justify-space-between px-6">
          <!-- üîµ ‡πÇ‡∏•‡πÇ‡∏Å‡πâ -->
          <v-img
            :src="logo"
            max-width="90"
            class="mx-3 mt-3"
            alt="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"
            aspect-ratio="1"
            cover
          ></v-img>

          <!-- üîµ ‡∏õ‡πâ‡∏≤‡∏¢‡∏ß‡∏¥‡πà‡∏á -->
          <div class="marquee">
            <div class="marquee-text">üéâ ‡πÑ‡∏≠.‡∏û‡∏µ.‡∏ß‡∏±‡∏ô ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üéâ</div>
          </div>

          <!-- üîµ ‡πÄ‡∏ß‡∏•‡∏≤ -->
          <div class="clock text-h5 font-weight-bold d-flex align-center">
            <v-icon start class="me-2">mdi-calendar-clock</v-icon>
            {{ currentTime }}
          </div>
        </div>

        <!-- üîµ ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠) -->
        <v-container fluid class="pa-6" style="flex: 1; overflow-y: auto">
          <v-card class="elevation-2 pa-4" style="height: 100%; border-radius: 12px">
            <!-- ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
            <v-row
              class="mb-4 py-4"
              style="background-color: #f8c849; border-radius: 12px"
            >
              <v-col cols="3" class="text-center">
                <div
                  style="
                    font-size: 2.8rem;
                    font-weight: 600;
                    color: #424242;
                    letter-spacing: 0.5px;
                  "
                >
                  ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ
                </div>
              </v-col>

              <v-col cols="3" class="text-center">
                <div
                  style="
                    font-size: 2.8rem;
                    font-weight: 600;
                    color: #424242;
                    letter-spacing: 0.5px;
                  "
                >
                  ‡∏à‡∏∏‡∏î‡∏•‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </div>
              </v-col>
              <v-col cols="3" class="text-center">
                <div
                  style="
                    font-size: 2.8rem;
                    font-weight: 600;
                    color: #424242;
                    letter-spacing: 0.5px;
                  "
                >
                  ‡πÄ‡∏ß‡∏•‡∏≤
                </div>
              </v-col>
              <v-col cols="3" class="text-center">
                <div
                  style="
                    font-size: 2.8rem;
                    font-weight: 600;
                    color: #424242;
                    letter-spacing: 0.5px;
                  "
                >
                  ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </div>
              </v-col>
            </v-row>

            <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
            <v-row v-for="(item, idx) in filteredList" :key="idx">
              <v-col cols="12">
                <div
                  class="d-flex align-center px-4 py-4"
                  style="border-left: 6px solid #1976d2; border-bottom: 1px solid #e0e0e0"
                >
                  <v-row no-gutters class="w-100">
                    <v-col cols="3" class="text-center">
                      <div
                        style="
                          font-size: 2.8rem;
                          font-weight: 600;
                          color: #1976d2;
                          letter-spacing: 0.5px;
                        "
                      >
                        {{ item.queueID }}
                      </div>
                    </v-col>
                    <v-col cols="3" class="text-center">
                      <div
                        style="
                          font-size: 2.8rem;
                          font-weight: 600;
                          color: #424242;
                          letter-spacing: 0.5px;
                        "
                      >
                        {{ item.dropOffLocationShort }}
                      </div>
                    </v-col>
                    <v-col cols="3" class="text-center">
                      <div
                        style="
                          font-size: 2.8rem;
                          font-weight: 600;
                          color: #424242;
                          letter-spacing: 0.5px;
                        "
                      >
                        {{ item.startTime }} ‡∏ô.
                      </div>
                    </v-col>
                    <v-col cols="3" class="text-center">
                      <div
                        style="
                          font-size: 2.8rem;
                          font-weight: 600;
                          color: #424242;
                          letter-spacing: 0.5px;
                        "
                      >
                        {{ getStatusLabel(item.status) }}
                      </div>
                    </v-col>
                  </v-row>
                </div>
              </v-col>
            </v-row>
          </v-card>
        </v-container>
      </v-container>
    </v-main>
  </v-app>
</template>

<script setup>
import { ref, computed, onMounted, watch } from "vue";
import { useRoute } from "vue-router";
import { gQueueShowAsync } from "@/services/apiTruckQueue.js";

const route = useRoute();

const dropOff = ref(null);
const logo = new URL("@/assets/images/white-Truckqueue-Logo.png", import.meta.url).href;

watch(
  () => route.query.dropOff,
  (val) => {
    dropOff.value = val || null;
  },
  { immediate: true }
);

const queueList = ref([]);

// ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° dropOff ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
const filteredList = computed(() => {
  if (dropOff.value) {
    return queueList.value.filter((item) => item.dropOffLocationShort === dropOff.value);
  }
  return queueList.value;
});

// ‡πÄ‡∏ß‡∏•‡∏≤
const currentTime = ref("");
const updateClock = () => {
  const now = new Date();
  const date = now.toLocaleDateString("th-TH", {
    day: "2-digit",
    month: "short",
    year: "numeric",
  });

  const time = now.toLocaleTimeString("th-TH", {
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
  });
  currentTime.value = `${date} | ${time}`;
};
const fetchQueueData = async () => {
  try {
    const data = await gQueueShowAsync();
    queueList.value = data.results;
  } catch (error) {
    console.error("Error loading queue data:", error);
  }
};

const statusLabelMap = {
  OPEN: "‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≠‡∏á",
  CONFIRMED: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß",
  ACCEPTED: "‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß",
  CHECKIN: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô",
  INPROGRESS: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£",
  CHECKOUT: "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå",
  COMPLETED: "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå",
  CANCELLED: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
};

const getStatusLabel = (status) => {
  return statusLabelMap[status] || status; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ mapping ‡∏Å‡πá‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
};

onMounted(async () => {
  updateClock();
  setInterval(updateClock, 1000);
  fetchQueueData(); // üî∏ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
  setInterval(fetchQueueData, 5000); // üî∏ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥
});
</script>

<style scoped>
.full-screen-container {
  background-color: #f4f6f8;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

.marquee-bar {
  background-color: #007fc4;
  color: white;
  height: 90px;
  min-height: 90px;
  width: 100%;
}

.marquee {
  overflow: hidden;
  white-space: nowrap;
  flex: 1;
  margin-right: 20px;
  position: relative;
}

.marquee-text {
  display: inline-block;
  padding-left: 100%;
  animation: marquee 15s linear infinite;
  font-size: 3rem;
  font-weight: bold;
}

.clock {
  white-space: nowrap;
  color: #fff;
}

@keyframes marquee {
  0% {
    transform: translateX(0%);
  }
  100% {
    transform: translateX(-100%);
  }
}
</style>
